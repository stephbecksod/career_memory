# Career Memory App — Complete Database Schema
**Version 1.1 · MVP + Forward-Compatible Design**

---

## Schema Overview

This schema supports V1 of the Career Memory App while remaining fully forward-compatible with planned features including personal entries, team/manager sharing, AI synthesis preferences, resume export, and billing. All major tables include soft deletes. Fields for future features are included now with nullable values so no migrations are required.

**Tables:**
1. [users](#1-users)
2. [companies](#2-companies)
3. [notification_schedules](#3-notification_schedules)
4. [sessions](#4-sessions)
5. [entries](#5-entries)
6. [professional_achievements](#6-professional_achievements)
7. [achievement_responses](#7-achievement_responses)
8. [questions](#8-questions)
9. [projects](#9-projects)
10. [tags](#10-tags)
11. [achievement_tags](#11-achievement_tags)
12. [user_preferences](#12-user_preferences)
13. [export_history](#13-export_history)
14. [subscriptions](#14-subscriptions)

**Constraint Legend**

| Symbol | Meaning |
|--------|---------|
| `PK` | Primary Key |
| `FK → table` | Foreign Key reference |
| `NOT NULL` | Required field |
| `nullable` | Optional field |

---

## 1. users

*Core identity and profile for every account. Preferences, notification schedules, and role context live in separate tables.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `user_id` | UUID | PK, NOT NULL | Generated by Supabase Auth |
| `email` | TEXT | NOT NULL | Unique. Used for auth and notifications |
| `first_name` | TEXT | NOT NULL | Used in push notifications and greetings |
| `last_name` | TEXT | nullable | Used in resume exports and full-name contexts |
| `timezone` | TEXT | NOT NULL | IANA format e.g. `America/New_York`. Required for scheduling notifications at correct local time. Auto-detected from device during onboarding, user-confirmable |
| `current_company_id` | UUID | nullable, FK → companies | Points to the active company. Null if user hasn't set one |
| `default_role_title` | TEXT | nullable | Default role copied onto new achievements. User can override per achievement |
| `avatar_url` | TEXT | nullable | Profile image URL (Supabase Storage or OAuth provider) |
| `onboarding_complete` | BOOLEAN | NOT NULL | Default `false`. Set to `true` when user completes first entry in onboarding flow. Account is fully active regardless of this value |
| `created_at` | TIMESTAMPTZ | NOT NULL | Account creation timestamp |
| `updated_at` | TIMESTAMPTZ | NOT NULL | Last profile update |
| `deleted_at` | TIMESTAMPTZ | nullable | Soft delete. Null = active account |

---

## 2. companies

*Stores each company a user has worked at. Enables filtering achievements by employer and powers future resume-by-role export features.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `company_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | NOT NULL, FK → users | |
| `name` | TEXT | NOT NULL | Company name as the user writes it |
| `industry` | TEXT | nullable | Freeform or enum later. e.g. `Technology`, `Finance` |
| `role_title` | TEXT | nullable | Primary role title at this company. Copied to achievements by default |
| `start_date` | DATE | nullable | Approximate is fine — used for resume date ranges |
| `end_date` | DATE | nullable | Null if current employer |
| `is_current` | BOOLEAN | NOT NULL | Default `false`. Only one company per user should be `true`. Enforced in app logic. When a new company is marked current, previous company's `is_current` is set to `false` and `end_date` is populated |
| `logo_url` | TEXT | nullable | Future: auto-fetch from Clearbit or similar |
| `created_at` | TIMESTAMPTZ | NOT NULL | |
| `deleted_at` | TIMESTAMPTZ | nullable | Soft delete |

---

## 3. notification_schedules

*Supports multiple simultaneous schedules per user (e.g. weekly wins + quarterly review). Each schedule fires independently and creates its own session.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `schedule_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | NOT NULL, FK → users | |
| `label` | TEXT | nullable | User-defined name e.g. `Weekly wins`, `Quarterly review` |
| `cadence_type` | TEXT | NOT NULL | Enum: `weekly` \| `monthly` \| `quarterly` \| `custom` |
| `day_of_week` | INTEGER | nullable | 0=Sunday…6=Saturday. Used when `cadence_type = weekly` |
| `day_of_month` | INTEGER | nullable | 1–31. Used for monthly/quarterly. App handles month-end edge cases |
| `notification_time` | TIME | NOT NULL | Local time to fire the notification |
| `timezone` | TEXT | NOT NULL | Copied from user at creation but stored independently in case user changes timezone later |
| `first_question_preview` | TEXT | nullable | Teaser question shown in the push notification body. Defaults to system question but user can customize |
| `is_active` | BOOLEAN | NOT NULL | Default `true`. Toggle to pause without deleting |
| `last_fired_at` | TIMESTAMPTZ | nullable | Timestamp of most recent notification send |
| `created_at` | TIMESTAMPTZ | NOT NULL | |
| `deleted_at` | TIMESTAMPTZ | nullable | Soft delete |

---

## 4. sessions

*Represents a single check-in moment — triggered by a notification or created manually (off-cadence). Sessions are the parent container for entries.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `session_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | NOT NULL, FK → users | |
| `schedule_id` | UUID | nullable, FK → notification_schedules | Null for off-cadence sessions. Populated when created by a notification |
| `session_date` | DATE | NOT NULL | The calendar date of the check-in |
| `is_scheduled` | BOOLEAN | NOT NULL | `true` if triggered by a notification, `false` if user initiated manually |
| `cadence_snapshot` | TEXT | nullable | Stores the `cadence_type` at time of session in case user changes cadence later |
| `created_at` | TIMESTAMPTZ | NOT NULL | |

---

## 5. entries

*The container for a set of achievements within a session. Entries are identified by date (not an AI-generated name). `section_type` lives here so that personal entries (future feature) can coexist with professional ones without touching the achievements tables.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `entry_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | NOT NULL, FK → users | Denormalized for efficient querying without joining through sessions |
| `session_id` | UUID | nullable, FK → sessions | Null for off-cadence entries |
| `entry_date` | DATE | NOT NULL | Primary display identifier for the entry. Used as the entry "name" in the UI |
| `section_type` | TEXT | NOT NULL | Enum: `professional` \| `personal`. Default `professional`. Personal is a future feature — included now for clean schema separation |
| `status` | TEXT | NOT NULL | Enum: `draft` \| `complete`. Default `draft` until user finishes and synthesizes all achievements |
| `ai_generated_summary` | TEXT | nullable | Live (potentially user-edited) AI summary of the entry as a whole. Generated after achievements are synthesized |
| `ai_generated_summary_ai` | TEXT | nullable | Original AI-generated entry summary. **Never overwritten after first write** |
| `note` | TEXT | nullable | Optional user-level note on the entry as a whole (separate from per-achievement notes) |
| `created_at` | TIMESTAMPTZ | NOT NULL | |
| `updated_at` | TIMESTAMPTZ | NOT NULL | |
| `deleted_at` | TIMESTAMPTZ | nullable | Soft delete |

---

## 6. professional_achievements

*The core unit of the app. Each achievement is a discrete accomplishment with its own question responses, AI synthesis, STAR structure, tags, and AI-generated name. This table feeds resume bullets, highlights, and quarterly reviews.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `achievement_id` | UUID | PK, NOT NULL | |
| `entry_id` | UUID | NOT NULL, FK → entries | |
| `user_id` | UUID | NOT NULL, FK → users | Denormalized for direct queries |
| `company_id` | UUID | nullable, FK → companies | Copied from user's current company at time of creation. Nullable because some achievements happen outside a formal role |
| `company_name_snapshot` | TEXT | nullable | Company name stored at time of creation. Protects display if company record is renamed later |
| `role_title` | TEXT | nullable | Copied from user default but overridable. Stored on the achievement for historical accuracy |
| `project_id` | UUID | nullable, FK → projects | Optional project association |
| `display_order` | INTEGER | NOT NULL | Order of this achievement within the entry. Default `1` |
| `source_platform` | TEXT | NOT NULL | Default `manual`. Future values: `import`, `api`, `slack_integration` |
| **AI Name** | | | |
| `ai_generated_name` | TEXT | nullable | Live (potentially user-edited) AI-generated name. Generated at same time as synthesis. 4–7 words, descriptive, no punctuation. Fallback display while generating: "[Date] achievement" |
| `ai_generated_name_ai` | TEXT | nullable | Original AI-generated name. **Never overwritten after first write** |
| **Synthesis fields** | | | |
| `synthesis_status` | TEXT | NOT NULL | Enum: `pending` \| `processing` \| `complete` \| `error`. Default `pending` |
| `synthesis_paragraph` | TEXT | nullable | Live (potentially user-edited) summary paragraph |
| `synthesis_paragraph_ai` | TEXT | nullable | Original AI-generated version. **Never overwritten after first write** |
| `synthesis_bullets` | JSONB | nullable | Live array of bullet strings. User-editable |
| `synthesis_bullets_ai` | JSONB | nullable | Original AI-generated bullets. **Never overwritten** |
| `synthesis_last_edited_at` | TIMESTAMPTZ | nullable | Null if user has never edited the synthesis |
| `synthesis_edited` | BOOLEAN | NOT NULL | Default `false`. `true` once user edits any synthesis field |
| **STAR fields** | | | *Each STAR component has a live (user-editable) version and an AI-original snapshot* |
| `star_situation` | TEXT | nullable | Live version (user-editable) |
| `star_situation_ai` | TEXT | nullable | Original AI extraction. Never overwritten |
| `star_task` | TEXT | nullable | Live version (user-editable) |
| `star_task_ai` | TEXT | nullable | Original AI extraction. Never overwritten |
| `star_action` | TEXT | nullable | Live version (user-editable) |
| `star_action_ai` | TEXT | nullable | Original AI extraction. Never overwritten |
| `star_result` | TEXT | nullable | Live version (user-editable) |
| `star_result_ai` | TEXT | nullable | Original AI extraction. Never overwritten |
| **Completeness (V2, null in V1)** | | | |
| `completeness_score` | INTEGER | nullable | 0–100. Null until synthesis runs. Powers V2 nudge features |
| `completeness_flags` | JSONB | nullable | Array of missing components e.g. `["metrics","situation"]`. Used for nudges |
| `completeness_calculated_at` | TIMESTAMPTZ | nullable | Timestamp of last completeness calculation |
| **Highlights** | | | |
| `is_highlight` | BOOLEAN | NOT NULL | Default `false`. Individual achievement highlight flag |
| `highlight_note` | TEXT | nullable | User-written or AI-suggested one-liner on why this is a highlight |
| `created_at` | TIMESTAMPTZ | NOT NULL | |
| `updated_at` | TIMESTAMPTZ | NOT NULL | |
| `deleted_at` | TIMESTAMPTZ | nullable | Soft delete |

---

## 7. achievement_responses

*Stores each individual question answer for an achievement. Separating responses into rows (rather than columns) means new questions can be added without schema changes. Audio is stored at the response level.*

**Critical implementation rule:** Raw responses must be written to this table BEFORE synthesis is triggered. If synthesis fails, the user's words are never lost.

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `response_id` | UUID | PK, NOT NULL | |
| `achievement_id` | UUID | NOT NULL, FK → professional_achievements | |
| `question_id` | UUID | nullable, FK → questions | Null if the response is a free-form entry not tied to a specific question |
| `question_key` | TEXT | nullable | Snapshot of the `question_key` at time of answer e.g. `headline`, `action`, `result`. Preserved even if question is later deleted |
| `question_text_snapshot` | TEXT | nullable | Full question text stored at time of answer. Protects display if question is edited later |
| `response_text` | TEXT | nullable | Typed or transcribed answer text |
| `audio_file_url` | TEXT | nullable | Supabase Storage URL. Null if response was typed |
| `audio_duration_seconds` | INTEGER | nullable | Duration of audio clip in seconds |
| `audio_expires_at` | TIMESTAMPTZ | nullable | 30 days from creation by default. Background cron job deletes file when past this timestamp |
| `transcript_raw` | TEXT | nullable | Raw Whisper API output before any cleanup |
| `created_at` | TIMESTAMPTZ | NOT NULL | |
| `updated_at` | TIMESTAMPTZ | NOT NULL | |

---

## 8. questions

*Stores both system-defined and user-created questions. System questions (`is_system = true`) are shared across all users and cannot be deleted. Users can deactivate them or add their own. `section_type` future-proofs the personal use case.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `question_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | nullable, FK → users | Null for system questions shared across all users. Populated for user-created custom questions |
| `question_text` | TEXT | NOT NULL | The prompt text shown to the user |
| `question_key` | TEXT | nullable | Slug identifier for system questions e.g. `headline`, `situation`, `action`, `result`, `metrics`, `skills`, `freeform`. Null for custom questions |
| `section_type` | TEXT | NOT NULL | Enum: `professional` \| `personal` \| `both`. Default `professional`. Enables future personal questions to coexist |
| `is_system` | BOOLEAN | NOT NULL | Default `false`. System questions cannot be deleted by users |
| `is_active` | BOOLEAN | NOT NULL | Default `true`. Users can deactivate system questions they don't want shown |
| `display_order` | INTEGER | NOT NULL | Controls render order in the achievement form |
| `helper_text` | TEXT | nullable | Optional sub-text shown under the question to guide the user |
| `created_at` | TIMESTAMPTZ | NOT NULL | |
| `deleted_at` | TIMESTAMPTZ | nullable | Soft delete for custom questions only |

### Default System Questions (seeded at launch)

The primary question uses STAR-oriented helper text without using the word "STAR" — keeping the language approachable.

| `question_key` | `question_text` | `helper_text` | `display_order` |
|----------------|-----------------|---------------|-----------------|
| `headline` | What did you accomplish? | Think about what you were working on, why it mattered, what you specifically did, and what the outcome was | 1 |
| `situation` | What was the situation or challenge? | What context or problem led to this work? | 2 |
| `action` | What did you specifically do? | Focus on your individual contribution | 3 |
| `result` | What was the result or impact? | What changed because of your work? | 4 |
| `metrics` | Do you have any numbers or data to support this? | Percentages, time saved, revenue, users — anything quantifiable | 5 |
| `skills` | What skills or strengths did this highlight? | Used to generate your tags automatically | 6 |
| `freeform` | Anything else worth capturing? | Any additional context or color | 7 |

---

## 9. projects

*User-defined projects that group related achievements across multiple entries and months. Projects have their own AI-generated summary that regenerates automatically as achievements are added. Archived projects remain linked to their achievements.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `project_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | NOT NULL, FK → users | |
| `company_id` | UUID | nullable, FK → companies | Optional company association. Useful for filtering projects by employer |
| `name` | TEXT | NOT NULL | Project name shown in dropdown when creating an achievement |
| `description` | TEXT | nullable | Short optional description to provide context |
| `status` | TEXT | NOT NULL | Enum: `active` \| `completed` \| `archived`. Default `active` |
| `start_date` | DATE | nullable | Approximate is fine |
| `end_date` | DATE | nullable | Null if ongoing |
| `is_highlight` | BOOLEAN | NOT NULL | Default `false`. Marks the entire project as a highlight in the highlight reel |
| `highlight_summary` | TEXT | nullable | Live user-editable project summary. Regenerates when new achievements are added — unless user has manually edited, in which case a "New achievements added — update your summary?" prompt is shown instead of auto-overwriting |
| `highlight_summary_ai` | TEXT | nullable | Original AI-generated cross-achievement synthesis. Never overwritten |
| `highlight_summary_last_edited_at` | TIMESTAMPTZ | nullable | Null if never manually edited by user. Used to determine whether to auto-update or prompt |
| `created_at` | TIMESTAMPTZ | NOT NULL | |
| `updated_at` | TIMESTAMPTZ | NOT NULL | |
| `deleted_at` | TIMESTAMPTZ | nullable | Soft delete — archived projects keep their achievement links intact |

---

## 10. tags

*Tag definitions. System tags are pre-seeded. User tags can be added freely. Categories enable skills-cloud and filtering features.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `tag_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | nullable, FK → users | Null for system tags shared across all users |
| `name` | TEXT | NOT NULL | Display name e.g. `Leadership`, `Shipped product`, `Cost reduction` |
| `slug` | TEXT | NOT NULL | Lowercase normalized version for deduplication and querying e.g. `cost_reduction`. Normalized on write |
| `category` | TEXT | nullable | Enum: `skill` \| `theme` \| `outcome` \| `tool` \| `other`. Enables grouped display and filtering |
| `is_system` | BOOLEAN | NOT NULL | Default `false`. System tags cannot be deleted |
| `color_hex` | TEXT | nullable | Optional display color for tag chips in the UI e.g. `#2563EB` |
| `created_at` | TIMESTAMPTZ | NOT NULL | |
| `deleted_at` | TIMESTAMPTZ | nullable | Soft delete for user-created tags |

### Default System Tags (seeded at launch)

| `name` | `slug` | `category` |
|--------|--------|------------|
| Leadership | `leadership` | theme |
| Cross-functional | `cross_functional` | theme |
| Shipped product | `shipped_product` | outcome |
| Cost reduction | `cost_reduction` | outcome |
| Revenue impact | `revenue_impact` | outcome |
| Process improvement | `process_improvement` | outcome |
| Mentorship | `mentorship` | skill |
| Communication | `communication` | skill |
| Problem solving | `problem_solving` | skill |
| Data analysis | `data_analysis` | skill |
| Project management | `project_management` | skill |
| Stakeholder management | `stakeholder_management` | skill |

---

## 11. achievement_tags

*Join table linking achievements to tags. Tracks whether each tag was AI-suggested or manually added — enabling future prompt improvement by comparing AI suggestions to user behavior.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `achievement_tag_id` | UUID | PK, NOT NULL | |
| `achievement_id` | UUID | NOT NULL, FK → professional_achievements | |
| `tag_id` | UUID | NOT NULL, FK → tags | |
| `is_ai_suggested` | BOOLEAN | NOT NULL | `true` if AI added this tag during synthesis. `false` if user added manually |
| `is_confirmed` | BOOLEAN | NOT NULL | Default `true`. AI-suggested tags the user removes are marked `false` rather than deleted — enables prompt improvement over time. Do not hard delete these rows |
| `created_at` | TIMESTAMPTZ | NOT NULL | |

---

## 12. user_preferences

*Flexible key-value preference storage. Keeping preferences in a separate table means new preferences can be added without schema migrations on the users table. `preference_key` is a defined set validated at the app layer.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `preference_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | NOT NULL, FK → users | |
| `preference_key` | TEXT | NOT NULL | See defined keys below |
| `preference_value` | TEXT | NOT NULL | Stored as text; app layer casts to correct type based on key |
| `updated_at` | TIMESTAMPTZ | NOT NULL | |

### Defined Preference Keys

| `preference_key` | Type | V1 Default | Notes |
|------------------|------|------------|-------|
| `synthesis_format` | enum | `all` | `paragraph` \| `bullets` \| `star` \| `all` |
| `show_completeness_nudge` | boolean | `false` | Off in V1, enabled when V2 nudge feature ships |
| `default_section_type` | enum | `professional` | `professional` \| `personal` |
| `notification_sound` | boolean | `true` | Whether push notifications play a sound |
| `theme` | enum | `system` | `light` \| `dark` \| `system` |
| `audio_retention_days` | integer | `30` | Days before audio files are automatically deleted |
| `has_seen_entries_tour` | boolean | `false` | Set to `true` after user dismisses the Entries page guided tour |
| `has_seen_projects_tour` | boolean | `false` | Set to `true` after user dismisses the Projects page guided tour |
| `has_seen_summary_tour` | boolean | `false` | Set to `true` after user dismisses the Summary page guided tour |

---

## 13. export_history

*Tracks every export action for user reference and product analytics. Included in V1 schema even though export features ship in a later version.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `export_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | NOT NULL, FK → users | |
| `export_type` | TEXT | NOT NULL | Enum: `pdf` \| `google_doc` \| `linkedin_copy` \| `resume_bullets` \| `notion` |
| `date_range_start` | DATE | nullable | Filter applied to the export |
| `date_range_end` | DATE | nullable | |
| `company_id_filter` | UUID | nullable, FK → companies | If export was filtered by company |
| `project_id_filter` | UUID | nullable, FK → projects | If export was filtered by project |
| `tag_filters` | JSONB | nullable | Array of `tag_id`s if export was filtered by tag |
| `achievement_count` | INTEGER | nullable | Number of achievements included in the export |
| `status` | TEXT | NOT NULL | Enum: `pending` \| `complete` \| `failed` |
| `file_url` | TEXT | nullable | Supabase Storage URL for downloadable exports (PDF etc.) |
| `file_expires_at` | TIMESTAMPTZ | nullable | Generated files expire after 24 hours |
| `created_at` | TIMESTAMPTZ | NOT NULL | |

---

## 14. subscriptions

*Billing and plan management. Included in V1 schema so adding a paywall later requires no migrations. Designed to integrate with Stripe via Supabase. A row with `plan_type = free` must be created for every new user at account creation.*

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `subscription_id` | UUID | PK, NOT NULL | |
| `user_id` | UUID | NOT NULL, FK → users | |
| `plan_type` | TEXT | NOT NULL | Enum: `free` \| `pro` \| `team` \| `enterprise`. Default `free` |
| `status` | TEXT | NOT NULL | Enum: `active` \| `canceled` \| `past_due` \| `trialing` \| `paused`. Default `active` |
| `stripe_customer_id` | TEXT | nullable | Stripe customer ID. Null until user enters billing |
| `stripe_subscription_id` | TEXT | nullable | Stripe subscription object ID |
| `trial_ends_at` | TIMESTAMPTZ | nullable | Null if no trial |
| `current_period_start` | TIMESTAMPTZ | nullable | Current billing period start |
| `current_period_end` | TIMESTAMPTZ | nullable | Current billing period end |
| `canceled_at` | TIMESTAMPTZ | nullable | Populated when user cancels |
| `created_at` | TIMESTAMPTZ | NOT NULL | |
| `updated_at` | TIMESTAMPTZ | NOT NULL | |

---

## Key Relationships

| Relationship | Notes |
|---|---|
| `users → companies` | One user, many companies. `current_company_id` on user points to the active one. Only one company has `is_current = true` at a time |
| `users → notification_schedules` | One user can have multiple active schedules (e.g. weekly + quarterly). Each fires independently |
| `notification_schedules → sessions` | A schedule fires and creates a session. `schedule_id` stored on session |
| `sessions → entries` | One session can have one or more entries (professional/personal in future) |
| `entries → professional_achievements` | One entry contains one or more achievements. Each is synthesized independently |
| `professional_achievements → achievement_responses` | One achievement has multiple question responses (one row per question answered) |
| `achievement_responses → questions` | Each response links back to the question that prompted it. `question_text_snapshot` preserves the text even if the question changes |
| `professional_achievements → achievement_tags` | Many-to-many via join table. Tracks AI vs. manual tagging and user confirmation |
| `professional_achievements → projects` | Optional. Many achievements can belong to one project. Adding an achievement triggers project summary regeneration |
| `projects → companies` | Optional project-company link for filtering |
| `users → user_preferences` | One row per preference key. Flexible without migrations. Includes guided tour state tracking |

---

## V1 Implementation Notes

- **Soft deletes everywhere** — all major tables have `deleted_at`. Never hard delete user data.
- **Save before synthesize** — raw responses must be written to `achievement_responses` before any AI synthesis call is triggered. Non-negotiable. If synthesis fails, the user's words are always preserved.
- **`_ai` columns are write-once** — never overwrite after first generation. App logic must enforce this. Only the live columns (without `_ai` suffix) are updated when users edit. This enables a future "revert to original" feature.
- **AI name generation** — `ai_generated_name` on achievements generates at the same time as synthesis (single API call). Target 4–7 words, descriptive, no punctuation. Fallback display while generating: "[Date] achievement".
- **Entry display** — entries are identified by `entry_date` in the UI, not a name. `ai_generated_summary` provides the entry-level context beneath the date on entry cards.
- **Tag slugs normalized on write** — lowercase, underscores, prevents duplicate tags with different casing.
- **`is_confirmed = false` on `achievement_tags`** — when a user removes an AI-suggested tag, mark `false`, do not delete. This data feeds future prompt improvement.
- **Subscriptions row created for every new user** — `plan_type = free` from day one so billing logic is always consistent.
- **Timezone stored on `notification_schedules` independently** — copied from user at creation but stored separately in case user's timezone changes later.
- **`company_name_snapshot` on achievements** — denormalize company name at time of creation. Protects display if user renames a company record later.
- **`question_text_snapshot` on responses** — store full question text at time of answer. Protects display if questions are edited later.
- **Audio retention cron** — Supabase Edge Function runs nightly, deletes audio files where `audio_expires_at < now()`. Default retention is 30 days.
- **Project summary auto-update** — when a new achievement is added to a project, `highlight_summary_ai` regenerates. If `highlight_summary_last_edited_at` is not null (user has manually edited), show a "New achievements added — update your summary?" prompt rather than auto-overwriting the live `highlight_summary`.
- **Guided tour tracking** — `has_seen_*_tour` preference keys are set to `true` when the user dismisses a page-level guided tour. Tours show once per page, never again after dismissal.
- **Completeness score fields** — stored in schema now, all null in V1. UI and nudge logic ships in V2.
- **Personal section** — `section_type` field is in schema but no personal flow is built in V1. Adding it later is a frontend and question config change, not a migration.
